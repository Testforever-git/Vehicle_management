{% extends 'base.html' %}
{% block page_title %}{{ t('admin_field_permissions.page_title') }}{% endblock %}
{% block content %}
<div class="card p-3">
  <h5 class="mb-3">{{ t('admin_field_permissions.list_title') }}</h5>
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead>
        <tr>
          <th>{{ t('admin_field_permissions.table') }}</th>
          <th>{{ t('admin_field_permissions.field') }}</th>
          <th>{{ t('admin_field_permissions.access_level') }}</th>
          <th>{{ t('admin_field_permissions.min_role') }}</th>
          <th>{{ t('admin_field_permissions.visible') }}</th>
          <th>{{ t('admin_field_permissions.editable') }}</th>
          <th>{{ t('admin_field_permissions.description') }}</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for item in field_permissions %}
        <tr>
          <form method="post" action="{{ url_for('admin.update_field_permissions', lang=lang) }}">
            <input type="hidden" name="permission_id" value="{{ item.id }}">
            <td>{{ item.table_name }}</td>
            <td>{{ item.field_name }}</td>
            <td>
              <select class="form-select form-select-sm" name="access_level">
                {% for level in access_levels %}
                  <option value="{{ level }}" {% if level == item.access_level %}selected{% endif %}>{{ level }}</option>
                {% endfor %}
              </select>
            </td>
            <td>
              <select class="form-select form-select-sm" name="min_role_code">
                {% for role in roles %}
                  <option value="{{ role.role_code }}" {% if role.role_code == item.min_role_code %}selected{% endif %}>
                    {{ role.role_code }}
                  </option>
                {% endfor %}
              </select>
            </td>
            <td>
              <select class="form-select form-select-sm" name="is_visible">
                <option value="1" {% if item.is_visible %}selected{% endif %}>{{ t('admin_field_permissions.yes') }}</option>
                <option value="0" {% if not item.is_visible %}selected{% endif %}>{{ t('admin_field_permissions.no') }}</option>
              </select>
            </td>
            <td>
              <select class="form-select form-select-sm" name="is_editable">
                <option value="1" {% if item.is_editable %}selected{% endif %}>{{ t('admin_field_permissions.yes') }}</option>
                <option value="0" {% if not item.is_editable %}selected{% endif %}>{{ t('admin_field_permissions.no') }}</option>
              </select>
            </td>
            <td>
              <input class="form-control form-control-sm" name="description" value="{{ item.description }}">
            </td>
            <td>
              <button class="btn btn-outline-primary btn-sm">{{ t('admin_field_permissions.update') }}</button>
            </td>
          </form>
        </tr>
        {% else %}
        <tr>
          <td colspan="8" class="text-muted">{{ t('admin_field_permissions.empty') }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endblock %}
