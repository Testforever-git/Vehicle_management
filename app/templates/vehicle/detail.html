{% extends 'base.html' %}
{% from 'macros/controls.html' import display_field with context %}
{% from 'macros/buttons.html' import action_button with context %}

{% set brand_label = (vehicle.brand_jp if lang == 'jp' else vehicle.brand_cn) or '-' %}
{% set model_label = (vehicle.model_jp if lang == 'jp' else vehicle.model_cn) or '-' %}
{% block page_title %}{{ brand_label }} / {{ model_label }}{% endblock %}

{% block content %}
<div class="row g-3">
  <div class="col-md-5">
    <div class="card p-3">
      <div class="ac-title-sub">{{ t('vehicle_detail.section_basic') }}</div>
      {% set etc_type_labels = {
        'none': t('vehicle_detail.etc_type_none'),
        'etc1': t('vehicle_detail.etc_type_etc1'),
        'etc2': t('vehicle_detail.etc_type_etc2')
      } %}
      {{ display_field('vehicle','brand_id', t('vehicle_detail.brand'), brand_label, 'main') }}
      {{ display_field('vehicle','model_id', t('vehicle_detail.model'), model_label) }}
      {{ display_field('vehicle','type_designation_code', t('vehicle_detail.type_designation_code'), vehicle.type_designation_code) }}
      {{ display_field('vehicle','plate_no', t('vehicle_detail.plate_no'), vehicle.masked_plate_no) }}
      {{ display_field('vehicle','vin', t('vehicle_detail.vin'), vehicle.vin) }}
      {{ display_field('vehicle','etc_type', t('vehicle_detail.etc_type'), etc_type_labels.get(vehicle.etc_type, vehicle.etc_type)) }}
    </div>

    <div class="mt-2 d-flex gap-2">
      {{ action_button('vehicle','edit', t('vehicle_detail.edit'), url_for('ui.vehicle_edit', vehicle_id=vehicle.id, lang=lang)) }}
      {% if qr_slug %}
        <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('qr.qr_public', qr_slug=qr_slug, lang=lang) }}">
          {{ t('vehicle_detail.qr_demo') }}
        </a>
      {% endif %}
    </div>
  </div>

  <div class="col-md-7">
    <div class="card p-3">
      <div class="ac-title-sub">{{ t('vehicle_detail.section_status') }}</div>
      {% if status %}
        {% set etc_card_label = '-' %}
        {% if status.has_etc_card is not none %}
          {% set has_etc_card = status.has_etc_card in [1, '1', true] %}
          {% set etc_card_label = t('vehicle_detail.has_etc_card_yes') if has_etc_card else t('vehicle_detail.has_etc_card_no') %}
        {% endif %}
        {{ display_field('vehicle_status','status', t('vehicle_detail.status'), status.status) }}
        {{ display_field('vehicle_status','mileage', t('vehicle_detail.mileage'), status.mileage ~ ' km') }}
        {{ display_field('vehicle_status','fuel_level', t('vehicle_detail.fuel_level'), status.fuel_level ~ ' %') }}
        {{ display_field('vehicle_status','location_desc', t('vehicle_detail.location_desc'), status.location_desc) }}
        {{ display_field('vehicle_status','inspection_due_yyyymm', t('vehicle_detail.inspection_due_yyyymm'), status.inspection_due_yyyymm) }}
        {{ display_field('vehicle_status','insurance_due_date', t('vehicle_detail.insurance_due_date'), status.insurance_due_date) }}
        {{ display_field('vehicle_status','has_etc_card', t('vehicle_detail.has_etc_card'), etc_card_label) }}
      {% else %}
        <p class="ac-text-meta">{{ t('vehicle_detail.no_status') }}</p>
      {% endif %}
    </div>

    <div class="card p-3 mt-3">
      <div class="ac-title-sub">{{ t('vehicle_detail.section_store') }}</div>
      {{ display_field('vehicle','garage_store_id', t('vehicle_detail.store_name'), vehicle.store_name) }}
    </div>

    <div class="card p-3 mt-3">
      <div class="ac-title-sub">{{ t('vehicle_detail.section_files') }}</div>
      {{ display_field('vehicle','legal_doc', t('vehicle_detail.legal_doc_dir'), legal_docs | length) }}
      {{ display_field('vehicle','vehicle_photo', t('vehicle_detail.vehicle_photo_dir'), vehicle_photos | length) }}
      <p class="ac-text-meta mb-0">
        {{ t('vehicle_detail.files_hint') }}
      </p>
    </div>
  </div>
</div>
{% endblock %}
