{% extends 'portal/base.html' %}

{% block page_title %}{{ t('portal.rental_booking_title') }}{% endblock %}

{% block content %}
<div class="card p-4">
  <div class="alert alert-success mb-3">{{ t('portal.rental_booking_success') }}</div>
  <p class="text-muted mb-4">{{ t('portal.rental_booking_magic_hint') }}</p>

  <div class="row g-3">
    <div class="col-lg-6">
      <div class="border rounded p-3 h-100">
        <h6 class="mb-3">{{ t('portal.rental_booking_summary_title') }}</h6>
        <dl class="row mb-0">
          <dt class="col-4">{{ t('portal.rental_booking_id') }}</dt>
          <dd class="col-8">#{{ booking.id }}</dd>
          <dt class="col-4">{{ t('portal.rental_booking_vehicle') }}</dt>
          <dd class="col-8">
            {% if lang == 'jp' %}
              {{ booking.brand_jp }} {{ booking.model_jp }}
            {% else %}
              {{ booking.brand_cn }} {{ booking.model_cn }}
            {% endif %}
            {{ booking.model_year_ad }}
          </dd>
          <dt class="col-4">{{ t('portal.rental_booking_dates') }}</dt>
          <dd class="col-8">{{ booking.start_date }} → {{ booking.end_date }}</dd>
          <dt class="col-4">{{ t('portal.rental_booking_pickup') }}</dt>
          <dd class="col-8">{{ price_snapshot.pickup_label or '-' }}</dd>
          <dt class="col-4">{{ t('portal.rental_booking_dropoff') }}</dt>
          <dd class="col-8">{{ price_snapshot.dropoff_label or '-' }}</dd>
          <dt class="col-4">{{ t('portal.rental_booking_total') }}</dt>
          <dd class="col-8">
            {{ price_snapshot.estimated_total or '-' }} {{ t('portal.rental_currency_unit') }}
          </dd>
          <dt class="col-4">{{ t('portal.rental_booking_deposit') }}</dt>
          <dd class="col-8">
            {{ price_snapshot.deposit_amount or '-' }} {{ t('portal.rental_currency_unit') }}
          </dd>
        </dl>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="border rounded p-3 h-100">
        <h6 class="mb-3">{{ t('portal.rental_booking_price_breakdown') }}</h6>
        <div class="d-flex justify-content-between">
          <span>{{ t('portal.rental_booking_daily_price') }}</span>
          <span>
            {{ price_snapshot.daily_price or 0 }}
            × {{ price_snapshot.rental_days or 0 }}
          </span>
        </div>
        <div class="d-flex justify-content-between text-muted">
          <span>{{ t('portal.rental_booking_insurance') }}</span>
          <span>
            {{ price_snapshot.insurance_per_day or 0 }}
            × {{ price_snapshot.rental_days or 0 }}
          </span>
        </div>
        <div class="d-flex justify-content-between text-muted">
          <span>{{ t('portal.rental_booking_cleaning_fee') }}</span>
          <span>{{ price_snapshot.cleaning_fee or 0 }}</span>
        </div>
        <div class="d-flex justify-content-between text-muted">
          <span>{{ t('portal.rental_booking_pickup_fee') }}</span>
          <span>{{ price_snapshot.pickup_fee or 0 }}</span>
        </div>
        <div class="d-flex justify-content-between text-muted">
          <span>{{ t('portal.rental_booking_dropoff_fee') }}</span>
          <span>{{ price_snapshot.dropoff_fee or 0 }}</span>
        </div>
        <div class="d-flex justify-content-between text-muted">
          <span>{{ t('portal.rental_booking_service_total') }}</span>
          <span>{{ price_snapshot.service_total or 0 }}</span>
        </div>

        {% if price_snapshot.service_items %}
        <div class="mt-3">
          <h6 class="text-muted small">{{ t('portal.rental_booking_services') }}</h6>
          <ul class="list-group list-group-flush">
            {% for item in price_snapshot.service_items %}
              {% set service = services.get(item.service_id) %}
              <li class="list-group-item d-flex justify-content-between px-0">
                <span>
                  {% if service %}
                    {{ service.name_jp if lang == 'jp' else service.name_cn }}
                  {% else %}
                    -
                  {% endif %}
                </span>
                <span>{{ item.total }}</span>
              </li>
            {% endfor %}
          </ul>
        </div>
        {% endif %}

        {% if price_snapshot.note %}
        <div class="mt-3">
          <h6 class="text-muted small">{{ t('portal.rental_booking_note') }}</h6>
          <div class="border rounded p-2 bg-light">{{ price_snapshot.note }}</div>
        </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}
